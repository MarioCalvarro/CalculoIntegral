\section{Teorema del Cambio de Variable}
Del mismo modo que para poder integrar en $\mathbb{R}$ podíamos hacer cambios de variable que simplificasen las expresiones que se debía integrar, es posible definir un teorema equivalente para dimensiones superiores que nos permiten cambiar el sistema de coordenadas sobre el que describir los objetos matemáticos y seguir integrando cómodamente.

\begin{theo}
Sea $T: \mathbb{R}^n \rightarrow \mathbb{R}^n$ lineal, si $A \subset \mathbb{R}^n$ es medible, entonces $T \left( A\right)$ es medible y se tiene que:
$$\mu_n \left(T\left(A\right)\right) = \lvert det \left(T\right) \rvert \cdot \mu_n \left(A\right)$$
\end{theo}

\begin{obs}
En el caso en el que $det \left(T\right) = 0$, entonces $T$ no es sobreyectiva y, por tanto, $T \left(\mathbb{R}^n\right)$ es una espacio vectorial propio de $\mathbb{R}^n$, los cuales tienen $\mu_n \left(T \left(\mathbb{R}^n\right)\right) = 0$.
\end{obs}

\begin{defi}[Difeomorfismo]
Sea $U, V \subset \mathbb{R}^n$ abiertos, se dice que $\varphi: U \rightarrow V$ es un \textbf{difeomorfismo} si: 
\begin{enumerate}
    \item $\varphi: U \rightarrow V$ es $C^{1)}$.
    \item $\varphi: U \rightarrow V$ es biyectiva. 
    \item $\varphi^{-1}: V \rightarrow U$ es $C^{1)}$
\end{enumerate}
\end{defi}

\begin{obs}
Sea $U \subset \mathbb{R}^n$ abierto y $\varphi: U \rightarrow \mathbb{R}^n$ de clase $C'$ tal que $\varphi$ es inyectiva en $U$ y $det \left(J \varphi \left(u\right) \right) \neq 0,\ \forall u \in U \Rightarrow$ por el Teorema de la Función Inversa, sabemos que $V = \varphi \left(U\right)$ es abierto y su inversa $\varphi^{-1}: V \rightarrow U$ es $C^1$. Es decir, $\varphi U \rightarrow \varphi \left(U\right)$ es un difeomorfismo-$C^1$.
\end{obs}

\begin{theo}
Sea $\varphi: U \rightarrow V$ un difeomorfismo-$C^{1)}$ entre dos abiertos de $\mathbb{R}^n$, si $A \subset U$ es medible, entonces $\varphi \left(A\right)$ es medible y se tiene que:
$$\mu \left(\varphi \left(A\right) \right) = \int_A \lvert \det J \varphi\left(u\right) \rvert \dif{u}$$
\end{theo}

\begin{obs}
Este teorema es una generalización del anterior, puesto que si $\varphi = T: \mathbb{R}^n \rightarrow \mathbb{R}^n$ es un isomorfismo lineal, entonces recuperamos el enunciado anterior.
\end{obs}

\begin{theo}[Cambio de variable]
Sea $\varphi: U \rightarrow V$ un difeomorfismo-$C^{1)}$ donde $U, V\subset \mathbb{R}^n$ abiertos, si $A\subset U$ es medible y $f: V \rightarrow \mathbb{R}$ es integrable en $ \varphi \left(A\right)$, entonces $f \circ \varphi: U \rightarrow R$ es integrable en $A$ y la integral se expresa como:
$$\int_{\varphi \left(A\right)} f = \int_A f \circ \varphi \cdot \lvert \det J \varphi \rvert$$
Que si tomamos como $A= U$, sería
$$\int_V f = \int_U f \circ \varphi \cdot \lvert \det J \varphi \rvert$$
Si tratamos de ponerlo en una notación más habitual: 
$$\int_{\varphi \left(A\right)} f \left(x\right) \dif{x} = \int_A f \left(\varphi \left(u\right)\right) \cdot \lvert \det J \varphi \left(u\right) \rvert \dif{u}$$
\end{theo}

\begin{obs}
Este teorema es la generalización total de los dos anteriores, ya que si $f = \chi_{\varphi \left(A\right)}$ obtenemos el teorema anterior.
\end{obs}

\begin{ej}
Supongamos la siguiente integral $$\int_E e^{\frac{x - y}{x + y}} \dif{x} \dif{y}$$
definiendo $E$ como el triángulo de vértices: $\left(0, 0\right), \left(0, 2\right), \left(2, 0\right)$, es decir:
$$\begin{tikzpicture}
\begin{axis}[
axis y line=middle,
axis x line=middle,
%xlabel=$x$,
%grid = both, %major/minor
];

\addplot [domain=0:2, samples=100, name path=f, thick, color=red!50]
        {-x + 2};

\path [name path=xaxis]
      (\pgfkeysvalueof{/pgfplots/xmin},0) --
      (\pgfkeysvalueof{/pgfplots/xmax},0);

\addplot[red!10, opacity=0.4] fill between [of=f and xaxis, soft clip={domain=-2:2}];
\node[color=black,right] at (axis cs: 0,0.1) {$(0,0)$};
\node[color=black,right] at (axis cs: 0,1.9)  {$(0,2)$};
\node[color=black,right] at (axis cs: 1.7,0.1)  {$(2,0)$};
\node[color=black,right] at (axis cs: 0.5,0.7) {$E$};
\node[color=red, font=\footnotesize] at (axis cs: 1.3,1) {$x + y = 2$};
\end{axis}
\filldraw [black] (0,0) circle (2pt);
\filldraw [black] (6.8,0) circle (2pt);
\filldraw [black] (0,5.7) circle (2pt);
\end{tikzpicture}$$
Si tenemos por ejemplo, la transformación $\varphi^{-1} = \begin{cases} u = x - y\\ v = x + y 
\end{cases} \Rightarrow \varphi = \begin{cases} x = \frac{u + v}{2}\\ y = \frac{v - u}{2} \end{cases}$, entonces podemos ver que:
\begin{align*}
\varphi^{-1} \left(x + y = 2\right) \equiv v = 2 & & \varphi^{-1} \left(y = 0\right)\equiv u = v & & \varphi^{-1} \left(x = 0\right)\equiv u = -v
\end{align*}
$$\begin{tikzpicture}
\begin{axis}[
axis y line=middle,
axis x line=middle,
%xlabel=$x$,
%grid = both, %major/minor
];

\addplot [domain=-2.5:2.5, samples=100, name path=f, thick, color=red!50]
        {abs(x)};

\addplot [domain=-2.5:2.5, samples=100, name path=g, thick, color=blue!50]
        {2};

\addplot[red!10, opacity=0.4] fill between [of=f and g, soft clip={domain=-2:2}];

\node[color=black,right] at (axis cs: 0,0.1) {$(0,0)$};
\node[color=black,right] at (axis cs: -2.5,1.9)  {$(-2,2)$};
\node[color=black,right] at (axis cs:1.8,1.9)  {$(2,2)$};
\node[color=black,right] at (axis cs: 0,1) {$D$};
\node[color=red, font=\footnotesize] at (axis cs: 1.3,1) {$u = v$};
\node[color=red, font=\footnotesize] at (axis cs: -1.3,1) {$u = -v$};
\node[color=blue, font=\footnotesize] at (axis cs: 0,2.2) {$v = 2$};
\end{axis}
\filldraw [black] (3.5,0) circle (2pt);
\filldraw [black] (6.2,4.55) circle (2pt);
\filldraw [black] (0.7,4.55) circle (2pt);
\end{tikzpicture}$$

Por tanto, $\varphi^{-1} \left(E\right) = D$ es un triángulo de vértices: $\left(0, 0\right), \left(2, 2\right) y \left(-2, 2\right)$ y entonces podemos calcular su integral como:
$$\int_E f \left(x, y\right) \dif{x} \dif{y} = \int_{\varphi \left(D\right)} f \left(x, y\right) \dif{x}\dif{y} = \int_D e^{u/v}\cdot \lvert \det J \varphi \left(u, v\right) \rvert \dif{u} \dif{v} =$$
$$= \int_{v = 0}^{v = 2} \int_{u = -v}^{u = v} e^{u/v} \frac{1}{2} \dif{u} \dif{v} = \int_{v = 0}^{v = 2} \frac{1}{2} \left[v e^{u/v}\right]_{u = -v}^{u = v} \dif{v} = $$
$$= \frac{1}{2} \int_0^2 v \left(e^{1} - e^{-1}\right) \dif{v} = \frac{e - e^{-1}}{2} \left[\frac{v^2}{2}\right]_{v = 0}^{v = 2} = e - \frac{1}{2} $$
\end{ej}

\subsection{Cambios de sistemas de coordenadas}
En muchas ocasiones, el trabajo con geometrías concretas suscita dificultades a la hora de ser descrita por los ejes cartesianos para integrar, derivar, hacer un estudio topológico... Para solventar este problema de representación existen ciertos cambios muy significativos en el sistema de coordenadas que facilitan mucho las cosas.

En concreto y con respecto a la integración, principalmente hay tres cambios muy notorios para poder integrar adecuadamente ciertos volúmenes o recintos. Estos cambios frecuentes y útiles se desarrollarán adelante exponiendo sus ventajas e inconvenientes.

\subsubsection{Coordenadas polares}
Este cambio de sistema de referencia es bastante útil para trabajar con recintos en $\mathbb{R}^2$ definidos por curvas, cónicas o circunferencias. Parten de la idea de que cada punto del espacio se puede representar a través de la longitud del segmento $r$ que lo une con el origen y del ángulo que forma dicho segmento con el eje de coordenadas.

\begin{defi}[Coordenadas Polares]
Se definen las \textbf{coordenadas polares} de un punto como la transformación que a cada componente $(x,y)$ le asocia su componente $(r, \theta)$ de forma que se verifica:
$$\begin{cases} x = r \cos \theta \\ y = r \sen \theta \end{cases} \mbox{ donde } \begin{cases} r \ge 0\\ 0 \le \theta \le 2\pi \end{cases}$$
\end{defi}

\begin{prop}
Sea $\varphi: \mathbb{R}^2\rightarrow  \mathbb{R}^2$ de forma que $\varphi(r, \theta) = (r\cos\theta, r\sen\theta)$, la restricción de $\varphi$ sobre el conjunto $\mathcal{U} = (0,\infty)\times (0, 2\pi)$ cumple que:
\begin{itemize}
\item $\varphi(\mathcal{U}) = \mathbb{R}^2\setminus{S}$ donde $S = \{(x,0)\in \mathbb{R}^2: x\geq 0\}$
\item $\varphi\mid_\mathcal{U}$ es un dimeomorfismo-$C^{1)}$
\item $J_\varphi = \begin{pmatrix}\cos \theta & -r\sen \theta \\ \sen \theta & r\cos \theta\end{pmatrix}$
\end{itemize}
\end{prop}

\begin{ej}
Supongamos que tenemos que calcular
$$\int_E x^2 + y^2 \dif{x}\dif{y} \mbox{ donde } E = \{\left(x, y\right): x^2 + y^2 \le 1\}$$
Podemos tomar en este caso que:
$$\varphi = \begin{cases} x = r\cos \theta \\ y = r\sen\theta \end{cases} \Rightarrow J\varphi = \begin{pmatrix} \cos \theta & -r\sen \theta \\ \sen \theta & r\cos \theta \end{pmatrix} \Rightarrow \det = r \ge 0$$
Entonces:
$$\int_E x^2 + y^2 \dif{x} \dif{y} = \int_{E\setminus S} \left(x^2 + y^2\right) \dif{x} \dif{y} = \int_{\theta = 0}^{\theta = 2\pi} \int_{r = 0}^{r = 1} r^2 \cdot r \dif{r} \dif{\theta} = 2\pi \left[\frac{r^4}{4}\right]_0^1 = \frac{\pi}{2} $$
\end{ej}

\subsubsection{Coordenadas cilíndricas}
Este tipo de coordenadas son bastante útiles para extrapolar la situación de las coordenadas polares a $\mathbb{R}^3$, de forma que permite sobre cada plano paralelo a $\mathbb{R}^2$ utilizar la misma representación que hacíamos en polares anteriormente.

\begin{defi}[Coordenadas Cilíndricas]
Se definen las \textbf{coordenadas cilíndricas} de un punto como la transformación que a cada componente $(x,y,z)$ le asocia su componente $(r, \theta, z)$ de forma que se verifica:
$$\begin{cases} x = r \cos \theta \\ y = r \sen \theta \\ z = z\end{cases} \mbox{ donde } \begin{cases} r \ge 0\\ 0 \le \theta \le 2\pi \\ -\infty < z < \infty \end{cases}$$
\end{defi}

\begin{prop}
Sea $\varphi: \mathbb{R}^3\rightarrow  \mathbb{R}^3$ de forma que $\varphi(r, \theta, z) = (r\cos\theta, r\sen\theta, z)$, la restricción de $\varphi$ sobre el conjunto $\mathcal{U} = (0,\infty)\times (0, 2\pi) \times (-\infty, \infty)$ cumple que:
\begin{itemize}
\item $\varphi(\mathcal{U}) = \mathbb{R}^3\setminus{S}$ donde $S = \{(x,0,z)\in \mathbb{R}^2: x\geq 0\}$
\item $\varphi\mid_\mathcal{U}$ es un dimeomorfismo-$C^{1)}$
\item $J_\varphi = \begin{pmatrix}\cos \theta & -r\sen \theta & 0 \\ \sen \theta & r\cos \theta & 0 \\ 0 & 0 & 1\end{pmatrix}$
\end{itemize}
\end{prop}

\begin{ej}
Tomando el mismo ejemplo anterior, pero integrando sobre
$$\int_V x^2 + y^2 \dif{x} \dif{y} \dif{z} \mbox{ donde } V = \{\left(x, y, z\right) : x^2 + y^2 \le z^2 \le 4\}$$

$$\begin{tikzpicture}[tdplot_main_coords]
  \coordinate (O) at (0,0,0);


  \coneback[surface]{-3}{2}{-10}
  \draw (0,0,-5) -- (O);
  \conefront[surface]{-3}{2}{-10}

  \draw[->] (-6,0,0) -- (6,0,0) node[right] {$x$};
  \draw[->] (0,-6,0) -- (0,6,0) node[right] {$y$};

  \coneback[surface]{3}{2}{10}
  \draw[->] (O) -- (0,0,5) node[above] {$z$};
  \conefront[surface]{3}{2}{10}
  \node[color=black,right] at  (0,0,3) {$z = 2$};
  \node[color=black,right] at  (0,0,-3) {$z = -2$};
\end{tikzpicture}$$
Por cada $z$ tenemos $V_z = \{\left(x, y\right): x^2 + y^2 \le z^2\}$, por tanto: 
$$\int_V x^2 + y^2 \dif{x} \dif{y} \dif{z} = \int_{z = -2}^{z = 2} \int_{\theta = 0}^{\theta = 2\pi} \int_{r = 0}^{r = \lvert z \rvert} r^2 \cdot r  \dif{r}   \dif{\theta} \dif{z}  = 2\pi \int_{z = -2}^{z = 2} \left(\int_{r = 0}^{r = \lvert z \rvert} r^3 \dif{r} \right) \dif{z}$$
$$ = 2\pi \int_{z = -2}^{z = 2} \left[\frac{r^4}{4}\right]_{r = 0}^{r = \lvert z \rvert} \dif{z} = \frac{\pi}{2} \int_{z = -2}^{z = 2} z^4 \dif{z} = \frac{\pi}{10} \left[z^{5}\right]_{z = -2}^{z = 2} = \frac{32\pi}{5} $$
\end{ej}

\subsubsection{Coordenadas Esféricas}
Este tipo de coordenadas también son coordenadas aplicables a $\mathbb{R}^3$ (puesto que en $\mathbb{R}^2$ son las polares que se han visto) para situaciones en las que los dominios estén definidos por cónicas o funciones de aspecto radial o centrales.

\begin{defi}[Coordenadas Esféricas]
Se definen las \textbf{coordenadas esféricas} de un punto como la transformación que a cada componente $(x,y,z)$ le asocia su componente $(r, \theta, \varphi)$ de forma que se verifica:
$$\begin{cases} x = r\cos \theta \sen \varphi\\ y = r\sen \theta \sen \varphi\\ z = r\cos \varphi \end{cases}\mbox{ donde }\begin{cases} r \ge 0\\ 0 \le \theta \le 2\pi\\ 0 \le \varphi \le \pi \end{cases}$$
\end{defi}
$$
\tdplotsetmaincoords{60}{110}
%
\pgfmathsetmacro{\rvec}{.8}
\pgfmathsetmacro{\thetavec}{30}
\pgfmathsetmacro{\phivec}{60}
%
\begin{tikzpicture}[scale=5,tdplot_main_coords]
    \coordinate (O) at (0,0,0);
    \draw[thick,->] (0,0,0) -- (1,0,0) node[anchor=north east]{$x$};
    \draw[thick,->] (0,0,0) -- (0,1,0) node[anchor=north west]{$y$};
\draw[thick,->] (0,0,0) -- (0,0,1) node[anchor=south]{$z$};
    \tdplotsetcoord{P}{\rvec}{\thetavec}{\phivec}
    \draw[-stealth,color=red] (O) -- (P) node[above right] {$P$};
    \draw[dashed, color=red] (O) -- (Pxy);
    \draw[dashed, color=red] (P) -- (Pxy);
    \tdplotdrawarc[-stealth]{(O)}{0.2}{0}{\phivec}{anchor=north}{$\theta$}
    \tdplotsetthetaplanecoords{\phivec}
    \tdplotdrawarc[-stealth, tdplot_rotated_coords]{(0,0,0)}{0.5}{0}%
        {\thetavec}{anchor=south west}{$\phi$}


\end{tikzpicture}
$$

\begin{prop}
Sea $\varphi: \mathbb{R}^3\rightarrow  \mathbb{R}^3$ de forma que $\varphi(r, \theta, \varphi) = (r\cos \theta \sen \varphi, r\sen \theta \sen \varphi, r\cos \varphi)$, la restricción de $\varphi$ sobre el conjunto $\mathcal{U} = (0,\infty)\times (0, 2\pi) \times (0, \pi)$ cumple que:
\begin{itemize}
\item $\varphi(\mathcal{U}) = \mathbb{R}^3\setminus{S}$ donde $S = \{(x,0,z)\in \mathbb{R}^2: x\geq 0\}$
\item $\varphi\mid_\mathcal{U}$ es un dimeomorfismo-$C^{1)}$
\item $J = \begin{pmatrix} \cos \theta \sen \varphi & -r\sen \theta \sen \varphi & r\cos \theta \cos \varphi\\ \sen \theta \sen \varphi & r\cos \theta \sen \varphi & r\sen \theta \cos\varphi\\ \cos \varphi & 0 & -r\sen \varphi \end{pmatrix}$, luego $\det J = r^2 \sen\varphi$
\end{itemize}
\end{prop}

\begin{ej}
Vamos a calcular el volumen de una esfera sólida, dada por $B_R = \{\left(x, y, z\right) : x^2 + y^2 + z^2 \le R^2\}$:
$$vol \left(B_R\right) = \mu_3 \left(B_r\right) = \int_{B_R} 1 \dif{x} \dif{y} \dif{z}=$$
$$= \int_{\theta = 0}^{\theta = 2\pi }\int_{\varphi = 0}^{\varphi = \pi} \int_{r = 0}^{r = R} 1 \cdot r^2 \sen \varphi \dif{r} \dif{\varphi } \dif{\theta} = $$
$$= \left(\underbrace{\int_{\theta = 0}^{2\pi }1 \dif{\theta }}_{= 2\pi} \right) \cdot \left(\underbrace{\int_{\varphi = 0}^{\varphi = \pi} \sen \varphi \dif{\varphi }}_{= 2}\right) \cdot \left(\underbrace{\int_{r = 0}^{r = R} r^2 \dif{r}}_{= \left[\frac{r^3}{3}\right]_0^R = \frac{R^3}{3}}\right) = \frac{4}{3} \pi R^3$$
\end{ej}

\begin{ej}
Buscamos el volumen limitado por la esfera $x^2 + y^2 + z^2 = A^2$ y el cilindro $x^2 + y^2 = ay,\ \left(a > 0\right)$.

\begin{center}
\includegraphics[scale=0.20]{Cone and Sphere}
\end{center}

Vemos que si tomamos coordenadas polares: $r = a\sen \theta$ y además se cumple que:
$$x^2 + y^2 - ay = 0 \Leftrightarrow x^2 + \left(y - \frac{a}{2}\right)^2 = \frac{a^2}{4}$$
Por lo que, considerando $D = \{\left(x, y\right): x^2 + y^2 \le ay\} = \{\left(x, y\right): x^2 + \left(y - \frac{a}{2}\right)^2 \le \frac{a^2}{4}\}$ que es la superficie de la base del cilindro, podemos calcular el volumen como: 
$$vol = 2 \int_{D} \sqrt{a^2 - x^2 - y^2} \dif{x} \dif{y} = $$
$$= 2 \int_{\theta = 0}^{\theta = \pi} \int_{r = 0}^{r = a\sen \theta } r \sqrt{a^2 - r^2} \dif{r} \dif{\theta} = 2 \int_{\theta = 0}^{\theta = \pi} \left[-\frac{1}{3} \left(a^2 - r^2 \right)^{3/2}\right]_{r = 0}^{r = a\sen \theta }\dif{\theta} = $$
$$= \frac{2}{3} \int_{\theta = 0}^{\theta = \pi} a^3 - a^3 \lvert \cos \theta  \rvert^3 \dif{\theta } = \frac{4}{3} \int_{\theta = 0}^{\theta = \frac{\pi}{2}} a^3 - a^3 \cos^3 \theta \dif{\theta } = \ldots = \boxed{\frac{4}{3}a^3 \left(\frac{\pi}{2} - \frac{2}{3}\right)} $$
\end{ej}